{% extends "base.html" %}
{% block title %}
  Страница пользователя {{ profile_user.username }}
{% endblock %}

{% block content %}
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-10">
        <h1 class="mb-5 text-center">Страница пользователя {{ profile_user.username }}</h1>
        
        <!-- Информация о пользователе -->
        <div class="card mb-5">
          <div class="card-body">
            <h5 class="card-title">Информация о пользователе</h5>
            <div class="row">
              <div class="col-md-6">
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">
                    <strong>Имя:</strong> {{ profile_user.first_name|default:"не указано" }}
                  </li>
                  <li class="list-group-item">
                    <strong>Фамилия:</strong> {{ profile_user.last_name|default:"не указано" }}
                  </li>
                </ul>
              </div>
              <div class="col-md-6">
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">
                    <strong>Email:</strong> {{ profile_user.email|default:"не указан" }}
                  </li>
                  <li class="list-group-item">
                    <strong>Регистрация:</strong> {{ profile_user.date_joined|date:"d E Y" }}
                  </li>
                </ul>
              </div>
            </div>
            
            <!-- Ссылки для владельца профиля - ТОЛЬКО 2 ССЫЛКИ -->
            {% if is_owner %}
              <div class="mt-4 text-center">
                <!-- 1. Ссылка на редактирование профиля -->
                <a href="{% url 'blog:edit_profile' %}" class="btn btn-outline-primary me-2">
                  Редактировать профиль
                </a>
                <!-- 2. Ссылка на изменение пароля -->
                <a href="{% url 'password_change' %}" class="btn btn-outline-warning">
                  Изменить пароль
                </a>
                <!-- НЕ добавляйте другие ссылки здесь для теста -->
              </div>
            {% endif %}
          </div>
        </div>
        
        <!-- Публикации пользователя -->
        <h3 class="mb-4">Публикации пользователя</h3>
        
        {% if page_obj %}
          {% for post in page_obj %}
            <div class="card mb-4">
              {% if post.image %}
                <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title }}" style="max-height: 300px; object-fit: cover;">
              {% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ post.title }}</h5>
                <h6 class="card-subtitle mb-2 text-muted">
                  <small>
                    {{ post.pub_date|date:"d E Y, H:i" }} | 
                    {% if post.location and post.location.is_published %}
                      {{ post.location.name }}
                    {% else %}
                      Планета Земля
                    {% endif %}
                  </small>
                </h6>
                <p class="card-text">{{ post.text|truncatewords:50 }}</p>
                
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <a href="{% url 'blog:post_detail' post.id %}" class="btn btn-sm btn-outline-primary">
                      Читать полностью
                    </a>
                    <span class="btn btn-sm btn-outline-secondary ms-2 disabled">
                      Комментарии ({{ post.comment_count|default:0 }})
                    </span>
                  </div>
                  
                  <!-- Кнопки редактирования/удаления поста - должны быть ВНУТРИ карточки поста -->
                  {% if user == post.author %}
                    <div class="btn-group btn-group-sm">
                      <a href="{% url 'blog:edit_post' post.id %}" class="btn btn-outline-secondary">
                        Редактировать
                      </a>
                      <a href="{% url 'blog:delete_post' post.id %}" class="btn btn-outline-danger">
                        Удалить
                      </a>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
          
          <!-- Пагинация -->
          {% if page_obj.has_other_pages %}
            <nav aria-label="Page navigation" class="mt-4">
              <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                  <li class="page-item">
                    <a class="page-link" href="?page=1">Первая</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a>
                  </li>
                {% endif %}
                
                {% for i in page_obj.paginator.page_range %}
                  {% if page_obj.number == i %}
                    <li class="page-item active">
                      <span class="page-link">{{ i }}</span>
                    </li>
                  {% else %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ i }}">{{ i }}</a>
                    </li>
                  {% endif %}
                {% endfor %}
                
                {% if page_obj.has_next %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Последняя</a>
                  </li>
                {% endif %}
              </ul>
            </nav>
          {% endif %}
          
        {% else %}
          <div class="alert alert-info" role="alert">
            {% if is_owner %}
              У вас пока нет публикаций.
            {% else %}
              У этого пользователя пока нет публикаций.
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}